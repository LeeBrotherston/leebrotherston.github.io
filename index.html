
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>SquareLemon</title>
	<meta name="author" content="Lee Brotherson">

	
	<meta name="description" content="Recently I have made some brief posts on the Snort/Suricata rules that I wrote to detect SuperFish and PrivDog, two pieces of Crapware/Malware/ &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="SquareLemon" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
</head>

<body>
	<div class="container">	

			<div class="mid-col-container">
				<div id="content" class="inner">
					


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-03-03T16:31:18-05:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/03/03/quick-and-dirty-crapware-analysis-ids-rule-creation-foo/">Quick &amp; Dirty Crapware Analysis - IDS Rule Creation Foo</a></h1>
	<div class="entry-content">
		<p>Recently I have made some brief posts on the <a href="https://github.com/LeeBrotherston/snort">Snort/Suricata rules</a> that I wrote to detect <a href="http://blog.squarelemon.com/blog/2015/02/20/superfish-detection/">SuperFish</a> and <a href="http://blog.squarelemon.com/blog/2015/02/23/privdog-detection/">PrivDog</a>, two pieces of Crapware/Malware/Adware/PUP that insert themselves as a Certificate Authority in the local browsers and proceed to Man in the Middle HTTPS traffic for the purposes of injecting ads.</p>

<p>In those posts I mentioned that CipherSuite fingerprinting was the key to creating the rules, however I didn&rsquo;t give a very comprehensive technical blow-by-blow.  So, now I have a new rule to add having noticed another application Man in the Middle&#8217;ing browsers (GeniusBox) using the same technique, it seems like an apt time to write up what I have been doing in a more useful way.
		
		<a href="/blog/2015/03/03/quick-and-dirty-crapware-analysis-ids-rule-creation-foo/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-23T14:42:07-05:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/23/privdog-detection/">PrivDog Detection</a></h1>
	<div class="entry-content">
		<p>In much the same way as I was <a href="http://blog.squarelemon.com/blog/2015/02/20/superfish-detection/">able to detect hosts infected with SuperFish</a> by profiling the changes in Cipher Suites used in their SSL connections (by virtue of SuperFish essentially having it&rsquo;s own SSL client) I have been able to create a fingerprint for PrivDog.  For those who are interested, the ciphersuites used by the PrivDog client are:
		
		<a href="/blog/2015/02/23/privdog-detection/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-20T14:53:52-05:00" pubdate data-updated="true">Feb 20<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/20/superfish-detection/">SuperFish Detection</a></h1>
	<div class="entry-content">
		<p>Much has been in the press the past couple of days regarding Superfish, specifically being pre-installed on Lenovo hardware, however the issues discussed are relevant to any device with Superfish installed.  It just so happens that Lenovo made the decision to bundle it up in the factory.</p>

<p>There are a number of write-ups on the technical nature of this malware/adware, and I won&rsquo;t attempt to rehash those, they are most likely better than anything that I could contribute anyway.  I did however want to be able to detect this on the network to offer network administrators a chance to locate devices on their network which may be affected.</p>

<p>By creating <a href="https://blog.filippo.io/make-your-own-superfish-infected-vm/">a Superfish infected VM</a> we can examine how the software works in a relatively controlled fashion.
		
		<a href="/blog/2015/02/20/superfish-detection/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-19T16:34:42-05:00" pubdate data-updated="true">Feb 19<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/19/man-in-the-middle-reach-grows/">Man in the Middle Reach Grows</a></h1>
	<div class="entry-content">
		<p>With all the talk of <a href="http://www.theregister.co.uk/2015/02/19/superfish_lenovo_spyware/">Lenovo</a> and <a href="http://arstechnica.com/security/2015/02/lenovo-pcs-ship-with-man-in-the-middle-adware-that-breaks-https-connections/">Superfish</a> in the press, now seems a good time to mention an update which is personal to me on the topic of Man in The Middle attacks.</p>

<p>People have asked me how widespread the <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">man in the middle attempts made my by ISP</a> actually are.  Well thankfully the manufacturer of the equipment used has put out a press statement around their current &ldquo;subscriber reach&rdquo; which you can read in full <a href="http://www.perftech.com/newsroom/perftech-adds-telco-giant-roster-q4-grows-subscriber-reach-30-2014/">here</a>.  The important paragraph for us is this:</p>

<blockquote><p>New-customer wins along with existing-customer expansions for 2014 resulted in a substantial increase in the aggregate subscriber reach across all PerfTechâ€™s ISP customers.  Previously at roughly 15 million subscribers, that total climbed to approximately 19.5 million for 2014, a gain of 30%.</p></blockquote>


<p>If these figures are to be believed, that&rsquo;s 19.5 million subscribers.  By my understanding a subscriber is a connection (e.g. one cable or DSL line), not a single device so the total user count is probably significantly higher.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-11T13:42:15-05:00" pubdate data-updated="true">Feb 11<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/11/the-value-of-cloud-security-report/">The Value of Cloud Security (Report)</a></h1>
	<div class="entry-content">
		<p>Today my employer, <a href="http://www.leviathansecurity.com">Leviathan Security</a>, released <a href="http://www.leviathansecurity.com/cloudsecurity/">three reports</a> written by <a href="http://twitter.com/myrcurial">James Arlen</a>, <a href="http://twitter.com/ussjoin">Brendan O&#8217;Connor</a> and <a href="http://twitter.com/synackpse">myself</a> on the overarching topic of Cloud Security.</p>

<p>I&rsquo;m pleased to say that they seem to have been well received by the press.  <a href="http://www.zdnet.com/article/cloud-security-reports-slam-data-protection-national-internets-access-myths/">ZDNet</a> (<a href="http://www.zdnet.com/article/how-infosec-hiring-lost-its-way-harsh-findings-in-leviathan-report/">twice</a>), <a href="http://www.itworldcanada.com/article/ottawa-risking-data-by-keeping-it-local-says-consultant/101843">IT World Canada</a> &amp; <a href="http://www.cloudwedge.com/leviathan-security-publishes-3-reports-on-cloud-data-security-4365/">CloudWedge</a> have all picked up on it so far.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-10T10:30:14-05:00" pubdate data-updated="true">Feb 10<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/10/os-x-sandbox-quickstart/">OS X Sandbox QuickStart</a></h1>
	<div class="entry-content">
		<p>The <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/sandbox-exec.1.html">sandbox feature on OS X</a> is really useful for restricting what applications have access to in more granular and controlled fashion than standard file permissions allow.  However writing the initial sandbox profile can be problematic for many users, it&rsquo;s not always clear what an application needs access to in order to operate in the expected way; there are a number of system files, libraries and such like, that an application quite rightly needs to read.</p>

<p>The news is not all bad, there are some really useful commands built in to OS X which can help.
		
		<a href="/blog/2015/02/10/os-x-sandbox-quickstart/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-09T10:09:46-05:00" pubdate data-updated="true">Feb 9<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/09/brakeing-down-security-podcast-isp-man-in-the-middle/">Brakeing Down Security Podcast - ISP Man in the Middle</a></h1>
	<div class="entry-content">
		<p>I made a return visit to the <a href="http://brakeingsecurity.blogspot.ca/2015/02/2015-005-is-your-isp-doing-man-in.html">Brakeing Down Security as a guest to discuss ISPs who Man in The Middle their customers</a>.  We discuss my Corporation in The Middle talk from <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">SecTor</a> &amp; <a href="http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides/">BSidesTO</a>.  Thanks again to <a href="https://twitter.com/bryanbrake">Bryan</a> and <a href="https://twitter.com/boettcherpwned">Brian</a> for having me!</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-04T13:17:01-05:00" pubdate data-updated="true">Feb 4<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/04/brakeing-down-security-podcast-threat-modeling/">Brakeing Down Security Podcast - Threat Modeling</a></h1>
	<div class="entry-content">
		<p>This week I was lucky enough to be a guest on the <a href="http://brakeingsecurity.blogspot.ca/">Brakeing Down Security podcast</a>, the specific episode is available <a href="http://brakeingsecurity.blogspot.ca/2015/01/2015-005-threat-modeling-with-lee.html">here</a>, or you can subscribe to the podcast <a href="https://itunes.apple.com/us/podcast/brakeing-down-security-podcast/id799131292?mt=2">here</a>.</p>

<br />


<p>Thanks to <a href="https://twitter.com/bryanbrake">Bryan</a> and <a href="https://twitter.com/boettcherpwned">Brian</a> for having me :)</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-04T11:28:07-05:00" pubdate data-updated="true">Feb 4<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/04/press-page/">Press Page</a></h1>
	<div class="entry-content">
		<p>Last year I would have never anticipated being quoted in the press, however it has happened a couple of times recently.  To keep track of this I have added a <a href="/press/">press page</a>.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-01-27T09:33:16-05:00" pubdate data-updated="true">Jan 27<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/01/27/citm-snort-rules/">Snort Rules - CitM</a></h1>
	<div class="entry-content">
		<p>Last year I gave my Corporation In The Middle talk in which I explained how my ISP has been man-in-the-middle&#8217;ing my connection to inject a warning banner into the top of webpages I visited (talk content <a href="blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">here</a> and <a href="http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides/">here</a>).</p>

<p>Part of this involved traffic analysis to discover artifacts of the injection process.  In an effort to make this process more automated, repeatable and accessible I have put together a few snort rules to allow others to alert on this condition:<br /></p>

<p><a href="https://github.com/LeeBrotherston/snort"><a href="https://github.com/LeeBrotherston/snort">https://github.com/LeeBrotherston/snort</a></a><br /></p>

<p>One rule is commented out as it is noisy and prone to false positives, however I have included it (disabled) for now, for reference.  The other three rules have been tested by me on my personal environment and seem to be free from false positives, however this is only a limited test and so feedback would be really appreciated from anyone running them elsewhere.<br /></p>

<p>Of course these are far from complete in terms of detection of man in the middle generically, they only pertain to the specific technique outlined in my talk, however I will endeavour to update them as I obtain further information.</p>

		
		
	</div>

</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
				</div>
			</div>
			<footer id="footer" class="inner">
				<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a> - 

    <a href="/about">Lee Brotherson</a>
 |
</footer>
			<script src="/javascripts/slash.js"></script>





	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-54930700-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




	</div>
</body>
</html>


<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>SquareLemon</title>
	<meta name="author" content="Lee Brotherson">

	
	<meta name="description" content="Last week I mentioned that James
Arlen and I gave the
closing keynote at SCCongress
Toronto. We had planned to do a live demo as part of the talk, &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="SquareLemon" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
</head>

<body>
	<div class="container">	

			<div class="mid-col-container">
				<div id="content" class="inner">
					


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-06-21T14:55:10-04:00" pubdate data-updated="true">Jun 21<span>st</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/06/21/mitm-the-mitmers/">MiTM&#8217;ing the MiTM&#8217;ers</a></h1>
	<div class="entry-content">
		<p>Last week I mentioned that <a href="https://www.twitter.com/myrcurial/">James
Arlen</a> and <a href="https://www.twitter.com/synackpse/">I</a> gave the
<a href="/blog/2015/06/12/sc-congress-toronto/">closing keynote at SCCongress
Toronto</a>.  We had planned to do a live demo as part of the talk, but after
reaching the venue and connecting to the wifi we found that it would not work
as planned, specifically because the venue wifi was &ldquo;correcting&rdquo; my tampering
of the DNS on the demo victim, they were still visiting the real website.</p>

<p>And so a new demo was born, the &ldquo;How this venue wifi is tampering with our, and
your, connection right now&rdquo; demo.</p>

<p>It appeared that DNS on this network was not used to determine which webserver
to contact when browsing to a page, it was merely a method to ensure that
connections were routed to anything other than the local network, at which
point something else took over.  This is pretty easy to demonstrate, by setting up
an /etc/hosts entry (used to locally override DNS for a particular FQDN) for a
website, directing it to an unused RFC1918 address which was not on the local
network, and by definition not on the internet either, we can test how DNS is
used.  The site still loaded up fine in a browser, this leads me to suspect
that a transparent proxy is inline somewhere, intercepting all traffic and then
using the host header in the HTTP request to determine which pages to deliver
as opposed to using the destination addres in the of the IP header.</p>

<p>Using tcptraceroute on port 80 we also find that every website tested was
apparently located on the local LAN, which of course they are not:</p>

<blockquote><p>$ sudo tcptraceroute www.google.com 80<br/>Selected device en0, address 192.168.1.4, port 55333 for outgoing packets<br/>Tracing the path to www.google.com (66.185.95.49) on TCP port 80 (http), 30 hops max<br/> 1  66.185.95.49 [open]  0.576 ms  0.744 ms  0.515 ms</p></blockquote>


<p>Finally using any packetsniffer (wireshark in this case), we can capture the
payload of a transaction and look for artifacts which may give away what is
happening.  In this instance it was very easy to spot:</p>

<blockquote><p>X-Cache: MISS from localhost<br/>X-Cache-Lookup: MISS from localhost:3128<br/>Via: 1.1 localhost:3128 (squid/2.7.STABLE9)</p></blockquote>


<p>These lines in the HTTP response header are not sent by the webserver, I was
visiting my own webserver, so I&rsquo;m pretty sure of this fact.  Anyone who has
experience in this field knows that this screams transparent proxy.  And if you
look up the version which is so helpfully displayed, you will notice that it
screams horribly out of date and probably not patched proxy.</p>

<p>The point that we made at the time is that a high percentage of users in the
audience are probably on this network as we spoke, that they were being MiTM&rsquo;d
without their knowledge.  If someone had compromised that old version of squid
that they could have been doing any number of things to those http connections
and the devices using them.</p>

<p>As security professionals we talk about the dangers of conference and coffee
shop wifi all the time, from the point of view of other users of the network
being malicious.  It&rsquo;s always worth remembering that you can&rsquo;t trust the venues
themselves to be completely clean either.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-06-12T10:38:51-04:00" pubdate data-updated="true">Jun 12<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/06/12/sc-congress-toronto/">SC Congress Toronto</a></h1>
	<div class="entry-content">
		<p>Yesterday <a href="https://twitter.com/myrcurial/">James Arlen</a> and <a href="https://twitter.com/synackpse/">I</a> gave the closing Keynote at <a href="http://www.sccongress.com/toronto/">SC Congress Toronto</a>.<br /></p>

<p>If you would like to see the slides, we have made the available on slideshare:</p>

<iframe src="https://www.slideshare.net/slideshow/embed_code/key/81965WLKIkp1Dr" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


<p>And the pre-recorded demo is available here (the live demo was, unfortunately, not recorded):</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/ew-2kMLcdLs" frameborder="0" allowfullscreen></iframe>


		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-05-28T10:12:50-04:00" pubdate data-updated="true">May 28<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/05/28/bsides-toronto-2015-is-coming-dot-dot-dot/">BSides Toronto 2015 Is Coming&#8230;</a></h1>
	<div class="entry-content">
		<p>Returning for it&rsquo;s third year, <a href="http://www.bsidesto.ca/">BSides
Toronto</a> has just been announced for 7th November 2015 and the CFP opened,
so if you want to speak get your submission in!  (details on <a
href="http://www.bsidesto.ca/">the BSidesTO website</a>).<br /></p>

<p>Keep an eye out on <a href="http://twitter.com/bsidesto/">Twitter</a> too as
announcements when registration opens, speakers are announced, etc.<br /></p>

<p>I won&rsquo;t be speaking this year because I have the pleasure of taking one of the
spots as an organiser for the conference, so I will definitely be there&hellip;
lurking :)</p>

<p><img src="http://blog.squarelemon.com/images/upload/glitchsides.png"></p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-05-25T10:37:21-04:00" pubdate data-updated="true">May 25<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/05/25/stealthier-attacks-and-smarter-defending-with-tls-fingerprinting/">Stealthier Attacks and Smarter Defending With TLS Fingerprinting</a></h1>
	<div class="entry-content">
		<p>I am really pleased to announce that I have decided to try my hand at talking
at conferences again this year and have a new talk ready &ldquo;Stealthier Attacks
and Smarter Defending with TLS Fingerprinting&rdquo;.  Despite being a talk on TLS
(and SSL) there isn&rsquo;t any complex crypto or mathematics, this is aimed at
defenders and attackers rather than cryptographers.  Here&rsquo;s the abstract:<br /></p>

<blockquote><p>Ever been busted because you man in the middle software (which does TLS properly) alerted someone to your bad certificate?  No more! Want to detect certain types of connections leaving your network, but can&#8217;t keep the IP blacklist up to date?  This could be the answer.</p><p>This talk includes an introduction to both TLS and man in the middle attacks, a walkthrough on what TLS fingerprints contain, how to create your own fingerprints, how we use the fingerprints in several scenarios, a demo, and a discussion of implications and pitfalls.</p><p>TLS provides transport security to all manner of connections from legitimate financial transactions to private conversations and malware calling home.  The inability to analyse encrypted traffic protects its users, whether they are legitimate or malicious.  This talk explores a technique for quickly and passively fingerprinting TLS clients and adapting our responses for the purposes of both attack and defence. Attackers can make automated decisions concerning when to man in the middle a connection and when to let the clients pass through silently, remaining stealthy.  Defenders can gain insight into what is making encrypted connections within their networks without access to either endpoints or cryptographic keying material.</p></blockquote>


<p>I am really excited to have been accepted to speak at <a href="http://www.sector.ca/">SecTor</a> for the second time in October (page for my session <a href="http://www.sector.ca/Program/Sessions/Session-Details/stealthier-attacks-and-smarter-defending-with-tls-fingerprinting">here</a>).</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-03-18T10:38:14-04:00" pubdate data-updated="true">Mar 18<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/03/18/mitm-in-telecoms-networks-i-told-you-so-dot-dot-dot-sort-of/">MiTM in Telecoms Networks. I Told You So&#8230; Sort Of.</a></h1>
	<div class="entry-content">
		<p>For anyone that has read this blog before, you will probably know that at the end of 2014 I gave my &ldquo;Corporation in The Middle&rdquo; talk at both <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">SecTor</a> and <a href="http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides/">BSides Toronto</a>.  In short my ISP (<a href="http://www.rogers.com">Rogers</a>) used a platform to Man (Corporation) in The Middle my and every other customers connection in order to insert notification banners at the top of pages in certain circumstances, such approaching your bandwidth cap.  I argued during my &ldquo;What Could Possibly Go Wrong?&rdquo; section that even if my ISP was completely well intentioned that the mere presence of this platform presented a risk to customers.  What would happen if they had a rogue member of staff, became coerced in some way or were hacked?  A malicious 3rd party could use their platform to inject javascript to drop 0-day or socially engineer users with fake Flash or Java updates, for example.</p>

<p>Then last night I read the article <i>&ldquo;<a href="http://www.theglobeandmail.com/news/national/nsa-trying-to-map-rogers-rbc-communications-traffic-leak-shows/article23491118/">NSA trying to map Rogers, RBC communications traffic, leak shows</a>&rdquo;</i> in The Globe and Mail.  It describes a leaked NSA document entitled <i>“Private Networks: Analysis, Contextualization and Setting the Vision”</i>, the article goes on to say <i>&ldquo;A comparison of this document with previous Snowden leaks suggests it may be a preliminary step in broad efforts to identify, study and, if deemed necessary, “exploit” organizations’ internal communication networks.&rdquo;</i>.  Of course there are no details as to if this ever came to pass and if it did to what degree any penetration took place, however I believe that this does indeed demonstrate that my fears were not completely unfounded.</p>

<p>If anybody were to penetrate the networks of any ISPs running tools such as this, these injection/interception platforms provide an easy mechanism to attack the customer base en mass.  To provide an indication of scale Perftech, the manufacturer of the platform used by my ISP, published in January that their <a href="http://www.perftech.com/newsroom/perftech-adds-telco-giant-roster-q4-grows-subscriber-reach-30-2014/">overall subscriber reach is currently 19.5 million</a>, and that&rsquo;s just one manufacturer.</p>

<p>There are many platforms that &ldquo;legitimately&rdquo; Man in The Middle our communications, however, unless properly managed and secured they can become a very useful tool in an adversaries arsenal.</p>

<p>Corporations which are targetted by nation state intelligence agencies are unlikely to successfully defend themselves.  Making announcements via these interception platforms as opposed to using something more (less?) transparent and obvious to the user removes the opportunity for the user to make informed security decisions.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-03-05T16:26:33-05:00" pubdate data-updated="true">Mar 5<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/03/05/csi-cyber-its-not-all-bad/">CSI:Cyber - It&#8217;s Not _all_ Bad</a></h1>
	<div class="entry-content">
		<p>I made my inaugural post on the <a href="https://twitter.com/LeviathanSec">@LeviathanSec</a> blog. <a href="https://www.leviathansecurity.com/blog/unpopular-opinion-csi-cyber-could-be-good-for-information-security/">Why CSI: Cyber could actually be good for infosec</a>.</p>

		
		
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-03-04T08:31:18-05:00" pubdate data-updated="true">Mar 4<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/03/04/quick-and-dirty-crapware-analysis-ids-rule-creation-foo/">Quick &amp; Dirty Crapware Analysis - IDS Rule Creation Foo</a></h1>
	<div class="entry-content">
		<p>Recently I have made some brief posts on the <a href="https://github.com/LeeBrotherston/snort">Snort/Suricata rules</a> that I wrote to detect <a href="http://blog.squarelemon.com/blog/2015/02/20/superfish-detection/">SuperFish</a> and <a href="http://blog.squarelemon.com/blog/2015/02/23/privdog-detection/">PrivDog</a>, two pieces of Crapware/Malware/Adware/PUP that insert themselves as a Certificate Authority in the local browsers and proceed to Man in the Middle HTTPS traffic for the purposes of injecting ads.</p>

<p>In those posts I mentioned that CipherSuite fingerprinting was the key to creating the rules, however I didn&rsquo;t give a very comprehensive technical blow-by-blow.  So, now I have a new rule to add having noticed another application Man in the Middle&#8217;ing browsers (<a href="http://geniusbox.net/">GeniusBox</a>) using the same technique, it seems like an apt time to write up what I have been doing in a more useful way.
		
		<a href="/blog/2015/03/04/quick-and-dirty-crapware-analysis-ids-rule-creation-foo/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-23T14:42:07-05:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/23/privdog-detection/">PrivDog Detection</a></h1>
	<div class="entry-content">
		<p>In much the same way as I was <a href="http://blog.squarelemon.com/blog/2015/02/20/superfish-detection/">able to detect hosts infected with SuperFish</a> by profiling the changes in Cipher Suites used in their SSL connections (by virtue of SuperFish essentially having it&rsquo;s own SSL client) I have been able to create a fingerprint for PrivDog.  For those who are interested, the ciphersuites used by the PrivDog client are:
		
		<a href="/blog/2015/02/23/privdog-detection/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-20T14:53:52-05:00" pubdate data-updated="true">Feb 20<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/20/superfish-detection/">SuperFish Detection</a></h1>
	<div class="entry-content">
		<p>Much has been in the press the past couple of days regarding Superfish, specifically being pre-installed on Lenovo hardware, however the issues discussed are relevant to any device with Superfish installed.  It just so happens that Lenovo made the decision to bundle it up in the factory.</p>

<p>There are a number of write-ups on the technical nature of this malware/adware, and I won&rsquo;t attempt to rehash those, they are most likely better than anything that I could contribute anyway.  I did however want to be able to detect this on the network to offer network administrators a chance to locate devices on their network which may be affected.</p>

<p>By creating <a href="https://blog.filippo.io/make-your-own-superfish-infected-vm/">a Superfish infected VM</a> we can examine how the software works in a relatively controlled fashion.
		
		<a href="/blog/2015/02/20/superfish-detection/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post">
	<div class="meta">
		<div class="date">








  


<time datetime="2015-02-19T16:34:42-05:00" pubdate data-updated="true">Feb 19<span>th</span>, 2015</time></div>
		
	</div>
	<h1 class="title"><a href="/blog/2015/02/19/man-in-the-middle-reach-grows/">Man in the Middle Reach Grows</a></h1>
	<div class="entry-content">
		<p>With all the talk of <a href="http://www.theregister.co.uk/2015/02/19/superfish_lenovo_spyware/">Lenovo</a> and <a href="http://arstechnica.com/security/2015/02/lenovo-pcs-ship-with-man-in-the-middle-adware-that-breaks-https-connections/">Superfish</a> in the press, now seems a good time to mention an update which is personal to me on the topic of Man in The Middle attacks.</p>

<p>People have asked me how widespread the <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">man in the middle attempts made my by ISP</a> actually are.  Well thankfully the manufacturer of the equipment used has put out a press statement around their current &ldquo;subscriber reach&rdquo; which you can read in full <a href="http://www.perftech.com/newsroom/perftech-adds-telco-giant-roster-q4-grows-subscriber-reach-30-2014/">here</a>.  The important paragraph for us is this:</p>

<blockquote><p>New-customer wins along with existing-customer expansions for 2014 resulted in a substantial increase in the aggregate subscriber reach across all PerfTech’s ISP customers.  Previously at roughly 15 million subscribers, that total climbed to approximately 19.5 million for 2014, a gain of 30%.</p></blockquote>


<p>If these figures are to be believed, that&rsquo;s 19.5 million subscribers.  By my understanding a subscriber is a connection (e.g. one cable or DSL line), not a single device so the total user count is probably significantly higher.</p>

		
		
	</div>

</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
</nav>

				</div>
			</div>
			<footer id="footer" class="inner">
				<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a> - 

    <a href="/about">Lee Brotherson</a>
 |
</footer>
			<script src="/javascripts/slash.js"></script>








	</div>
</body>
</html>

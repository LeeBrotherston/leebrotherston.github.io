<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[SquareLemon]]></title>
  <link href="http://blog.squarelemon.com/atom.xml" rel="self"/>
  <link href="http://blog.squarelemon.com/"/>
  <updated>2015-01-27T09:50:12-05:00</updated>
  <id>http://blog.squarelemon.com/</id>
  <author>
    <name><![CDATA[Lee Brotherson]]></name>
    <email><![CDATA[contact@squarelemon.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Snort Rules - CitM]]></title>
    <link href="http://blog.squarelemon.com/blog/2015/01/27/citm-snort-rules/"/>
    <updated>2015-01-27T09:33:16-05:00</updated>
    <id>http://blog.squarelemon.com/blog/2015/01/27/citm-snort-rules</id>
    <content type="html"><![CDATA[<p>Last year I gave my Corporation In The Middle talk in which I explained how my ISP has been man-in-the-middle&#8217;ing my connection to inject a warning banner into the top of webpages I visited (talk content <a href="blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">here</a> and <a href="http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides/">here</a>).</p>

<p>Part of this involved traffic analysis to discover artifacts of the injection process.  In an effort to make this process more automated, repeatable and accessible I have put together a few snort rules to allow others to alert on this condition:<br /></p>

<p><a href="https://github.com/LeeBrotherston/snort"><a href="https://github.com/LeeBrotherston/snort">https://github.com/LeeBrotherston/snort</a></a><br /></p>

<p>One rule is commented out as it is noisy and prone to false positives, however I have included it (disabled) for now, for reference.  The other three rules have been tested by me on my personal environment and seem to be free from false positives, however this is only a limited test and so feedback would be really appreciated from anyone running them elsewhere.<br /></p>

<p>Of course these are far from complete in terms of detection of man in the middle generically, they only pertain to the specific technique outlined in my talk, however I will endeavour to update them as I obtain further information.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MiTM at 30,000 feet]]></title>
    <link href="http://blog.squarelemon.com/blog/2015/01/04/mitm-at-30/"/>
    <updated>2015-01-04T23:38:11-05:00</updated>
    <id>http://blog.squarelemon.com/blog/2015/01/04/mitm-at-30</id>
    <content type="html"><![CDATA[<p>In the past week I have seen a few mentions on twitter regarding <a href="http://twitter.com/gogo">Gogo Air</a> presenting fake SSL certs for YouTube to users of their in air Internet access service:<br /><!-- More --></p>

<blockquote class="twitter-tweet" lang="en"><p>hey <a href="https://twitter.com/Gogo">@Gogo</a>, why are you issuing *.google.com certificates on your planes? <a href="http://t.co/UmpIQ2pDaU">pic.twitter.com/UmpIQ2pDaU</a></p>&mdash; Adrienne Porter Felt (@__apf__) <a href="https://twitter.com/__apf__/status/551083956326920192">January 2, 2015</a></blockquote>


<script async src="http://blog.squarelemon.com//platform.twitter.com/widgets.js" charset="utf-8"></script>




<br />




<blockquote class="twitter-tweet" lang="en"><p>No, not OK. <a href="https://twitter.com/Gogo">@Gogo</a> please justify breaking the Internet for your paying users. Huge privacy connotations! <a href="http://t.co/AxZOPEK0oO">pic.twitter.com/AxZOPEK0oO</a></p>&mdash; Ben Hughes (@benjammingh) <a href="https://twitter.com/benjammingh/status/551589274123247616">January 4, 2015</a></blockquote>


<script async src="http://blog.squarelemon.com//platform.twitter.com/widgets.js" charset="utf-8"></script>




<br />


<p>I started to wonder if they were using the same technique that I had recently been researching and discussing in my <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">Corporation in The Middle</a> talk.  Luckily for me, my friend <a href="https://twitter.com/benjammingh/">Benjammingh</a> was one of those who noticed and was currently on a Gogo flight, so I asked him to take a packetdump for analysis.<br /><br /><!-- More --></p>

<p>The short summary is that this is not the same technique, in fact this looks like in-flight transparent proxying&hellip;.<br /><br /></p>

<p>For one thing there is this giveaway in the http response header:<br /></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>X-Cache: MISS from 172.19.134.2
</span><span class='line'>X-Cache-Lookup: MISS from 172.19.134.2:3128
</span><span class='line'>Via: 1.0 172.19.134.2:3128 (squid/2.6.STABLE14)</span></code></pre></td></tr></table></div></figure>




<br />


<p>This is indeed squid, quite an old install of squid, on the default port.<br /><br /></p>

<p>Secondly, the TTL on all the packets was 64.  Now, most OS&rsquo;s tend to use round numbers for default TTL values (32, 64, 128).  Assuming this to be the case, this would indicate that either YouTube is exactly 64 hops away or the packets are originating from the local network segment, which would be consistent with a local (transparent) proxy.</p>

<br />


<p>It&rsquo;s hardly an in-depth analysis, but at this point it seems to be more than we have at the minute, and it would explain how they are Man in The Middle&#8217;ing the connection, the question still remains&hellip;. why?</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[No we don't]]></title>
    <link href="http://blog.squarelemon.com/blog/2015/01/02/no-we-dont/"/>
    <updated>2015-01-02T10:00:00-05:00</updated>
    <id>http://blog.squarelemon.com/blog/2015/01/02/no-we-dont</id>
    <content type="html"><![CDATA[<p>I just got a festive present from my ISP, <a href="http://www.rogers.com">Rogers</a>.<br /><br /></p>

<p>Following my <a href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/">recent <a href="http://blog.squarelemon.com/blog/2014/12/24/bsides-toronto-video-and-slides/">talks</a> regarding ISP packet injection/interception and data collection I wrote to the privacy officer at Rogers and asked, under PIPEDA, that I be supplied all information regarding my account, including any information that they have gathered such as URLs of sites visited, etc.<br /></p>

<br />


<p>I got a fairly standard response which said that they did not collect any such data, to which I replied:<!-- More --></p>

<br />


<blockquote><p>Hi,</p><p>I recently sent a letter to you asking for details of data that Rogers hold on me as required by PIPEDA.  As expected you, or someone in your department, kindly replied.  Thank you!</p><p>Most of it made sense however I did note that there was one area in particular that is inaccurate/untrue, specifically your statement &#8220;We do not collect the IP addresses or the domain names of the sites that you have visited or the time, dates and port numbers&#8221;.  I understand it is entirely possible that this was not deliberate and it&#8217;s more likely that you are unaware of some of the data that Rogers holds, nonetheless I thought that I should mention this so that this mistake is not replicated in the future placing you in breach of PIPEDA.</p><p>To provide you some insight, when you insert consumer messaging into webpages, such as the &#8220;you have exceeded 75% of your bandwidth allowance&#8230;&#8221; message, you use a system called the Bulletin System manufactured by Perftech to do so.  Putting aside the legality of this tool (I believe this breaks the Telecommunications Act) for a moment, you should note that this tool tracks user web browsing behavior (other than encrypted sessions) and keeps a history of the past 30 days tied to user account, irrespective of if that user is receiving any messaging at the time or not.</p><p>If it helps you to track down this system, one of it&#8217;s nodes (REDACTED) is currently live on the IP REDACTED within your network.</p><p>If you would like further information on this I have a sizeable amount of documentation and evidence to support this.</p><p>Please feel free to come back to me if you have any questions or queries.</p><p>Thanks</p><p>Lee</p></blockquote>




<br /><br />


<p>Their response?<br /><br /></p>

<p><img src="http://blog.squarelemon.com/images/corp_in_the_middle/rogers_letter_update.jpeg"></p>

<br /><br />


<p>I don&rsquo;t feel that this is going to progress anytime soon.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BSides Toronto Video &amp; Slides]]></title>
    <link href="http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides/"/>
    <updated>2014-12-29T11:59:00-05:00</updated>
    <id>http://blog.squarelemon.com/blog/2014/12/29/bsides-toronto-video-and-slides</id>
    <content type="html"><![CDATA[<p>At the end of November I gave my talk, &ldquo;Corporation In The Middle [BSidesTO Edition]&rdquo; at <a href="http://bsidesto.ca">BSides Toronto 2014</a>.</p>

<br />


<p>The recording of the talk is now online and available here:<br /></p>

<iframe width="560" height="315" src="http://blog.squarelemon.com//www.youtube.com/embed/_YeaYIPM-QI" frameborder="0" allowfullscreen></iframe>


<br />


<p>You can play along at home with the slides, here:<br /></p>

<iframe src="http://blog.squarelemon.com//www.slideshare.net/slideshow/embed_code/41918170" width="425" height="355" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="http://blog.squarelemon.com//www.slideshare.net/LeeBrotherston/corporation-in-the-middle-bsidesto-edition" title="Corporation In The Middle - BSidesTO Edition" target="_blank">Corporation In The Middle &ndash; BSidesTO Edition</a> </strong> from <strong><a href="http://blog.squarelemon.com//www.slideshare.net/LeeBrotherston" target="_blank">Lee Brotherston</a></strong> </div></p>

<br />

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Corporation In The Middle]]></title>
    <link href="http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle/"/>
    <updated>2014-10-29T22:59:58-04:00</updated>
    <id>http://blog.squarelemon.com/blog/2014/10/29/corporation-in-the-middle</id>
    <content type="html"><![CDATA[<p>A few days ago I presented my talk, &ldquo;Corporation In The Middle&rdquo; at <a href="http://sector.ca">SecTor 2014</a>.  I will be presenting an updated and truncated version of the talk at <a href="http://www.bsidesto.ca/">BSides Toronto</a> in November of this year.</p>

<p>If you are interested in seeing the talk you can do so here:</p>

<iframe src="http://blog.squarelemon.com//player.vimeo.com/video/110367213" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>


<br />


<p>If so inclined, you can also <a href="http://www.slideshare.net/LeeBrotherston/lee-brotherston-corporation-in-the-middle">get the slides here</a>.</p>

<br />


<p>The original blurb was:
<i>My ISP deliberately MiTM&rsquo;d my connection.  This talk discusses how they did it, how I detected what they did and what this means.  This talk covers what I learnt over three months of analysis focusing on the technology involved both on the ISP side and my own. I cover in detail how I went about identifying and mapping the ISPs hidden network components and how they modify IP connections. I will briefly cover what this means to customers of their service.  During the talk I will provide technical evidence as well as walk through how I used open source tools to unmask this Corp In The Middle attack.
</i></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Is your EULA lowering your Application Security?]]></title>
    <link href="http://blog.squarelemon.com/blog/2014/07/18/is-your-eula-lowering-your-application-security/"/>
    <updated>2014-07-18T09:55:44-04:00</updated>
    <id>http://blog.squarelemon.com/blog/2014/07/18/is-your-eula-lowering-your-application-security</id>
    <content type="html"><![CDATA[<p>A couple of days ago I tweeted this:</p>

<center>
<blockquote class="twitter-tweet" lang="en"><p>I&#39;m pretty sure when your EULA prohibits reverse engineering your software, all you prevent is people telling you that they reversed it.</p>&mdash; leE Brotherston (@leEb_public) <a href="https://twitter.com/leEb_public/statuses/489050821649506304">July 15, 2014</a></blockquote>
<script async src="http://blog.squarelemon.com//platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


<p>Quite a lot of people agreed (at the time of writing it has 40 retweets and 19 favourites, which is quite a lot for me), so I thought that I would expand and explain this in a little more detail.<!-- More --></p>

<p>The End User Licence Agreement (EULA) is something which is fairly common inclusion in commercial applications, and is typically something dreamed up by the legal team to attempt to enforce whatever it is that they feel needs to be added as part of the licencing agreement.  What prompted my particular comment was something I noticed in the EULA of an application I was using, which prohibited the user from being able to:</p>

<blockquote><p>&#8220;copy, distribute, publish, reverse engineer, decompile, disassemble, modify, or translate the Software&#8221;</p></blockquote>


<p>A <a href="https://duckduckgo.com/?q=%22copy%2C+distribute%2C+publish%2C+reverse+engineer%2C+decompile%2C+disassemble%2C+modify%2C+or+translate+the+Software%22">quick search</a> seems to indicate that this is a fairly common clause in a number of EULAs, particularly in the world of gambling (maybe they all use the same template or legal team).</p>

<p>My assumption is that this clause is included in order to prevent people from creating clone clients, perhaps ones which automate betting and casino style gambling, laundering via robot card games or perhaps just an attempt to hide flaws in the application stack somewhere.</p>

<p>My initial thought was merely that this would not prevent anyone with ill intentions from reversing the code.  People who are willing to use an application or service for fraudulent means are probably committing crimes such as fraud in the process, if they&rsquo;re able to accept that I don&rsquo;t believe that a licence violation will be a massive disincentive.</p>

<p>Similarly if people are not comitting a crime like fraud or money laundering, but are using automated tools to game the system by autmatically playing low-winning games for hours on end, for example, probably don&rsquo;t care about the EULA too much.</p>

<p>Finally, those who are seeking to reverse engineer the code to find exploits and attack the system in some way (ok this is also crime, but a different type) probably will not care about the EULA.</p>

<p>However&hellip;</p>

<p>Security researchers, for example, <b>are</b> likely to be dissuaded from taking a closer look at an application by a restrictive EULA, but they are the very people that we do not want to be dissuaded.  We want these people to find the problems and report them responsibly.  In a perfect world you would have a bug bounty program like those at <a href="https://www.etsy.com/ca/help/article/2463">Etsy</a>, <a href="https://www.facebook.com/whitehat">Facebook</a> and <a href="http://technet.microsoft.com/en-us/security/dn425036">Microsoft</a> to incentivize people to disclose bugs early and often.  But even without a formal bug bounty program in place dissuading researchers via the EULA could well lower your security posture.  Chances are that a resrictive EULA has just cut off their only option to report it to you responsibly without fear of some knee-jerk legal retaliation.  Instead, as <a href="https://twitter.com/essobi">@esSOBI</a> rightly points out:</p>

<center>
<blockquote class="twitter-tweet" lang="en"><p><a href="https://twitter.com/leEb_public">@leEb_public</a> <a href="https://twitter.com/thegrugq">@thegrugq</a> &#10;Do you want to wind up on pastebin? Cause that&#39;s how you wind up on pastebin.</p>&mdash; esSOBi (@essobi) <a href="https://twitter.com/essobi/statuses/489109019878248448">July 15, 2014</a></blockquote>
<script async src="http://blog.squarelemon.com//platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


<p>Perhaps it&rsquo;s time Information Security people engaged with Legal instead of dismissing the EULA on your product as &ldquo;business stuff&rdquo; and make sure that it isn&rsquo;t damaging your chances at a more secure product.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SecTor 2014]]></title>
    <link href="http://blog.squarelemon.com/blog/2014/05/24/sector-2014/"/>
    <updated>2014-05-24T23:42:56-04:00</updated>
    <id>http://blog.squarelemon.com/blog/2014/05/24/sector-2014</id>
    <content type="html"><![CDATA[<p>I was meant to start this blog with a post about my ISP, about how they had man in the middle&rsquo;d my connection and how I had been working out the details of why they had been doing this, how they achieved it and how I uncovered what they had been up to.</p>

<p>Since I started writing that post the topic has grown somewhat and now I have been confirmed as a <a href="http://sector.ca/Program/Sessions/Session-Details/evl/0/tag/16752/Lee-Brotherston">speaker at SecTor 2014</a> in Toronto.</p>

<p>So, the post is still coming&hellip;  But if you want to see me explain it in as much Powerpoint glory as I can muster, come on down to SecTor later this year :)</p>

<p>Edit: If you want a 10% discount on full conference entry use the code: SecTorSpeaker2014</p>
]]></content>
  </entry>
  
</feed>
